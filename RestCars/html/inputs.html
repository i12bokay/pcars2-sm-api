<html>
<head>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

<canvas width="200px" height="100" id="can"></canvas>

    <script language="javascript" type="text/javascript" src="jquery-2.2.0.min.js"></script>
    <script language="javascript" type="text/javascript">
	
	///////////////////////////////////////////////////////
	////                                               ////
	////    Made by Tony Richter, 20.02.2016, v0.1.3   ////
	////                                               ////
	///////////////////////////////////////////////////////
	
	const refreshInterval = 50; // Default 50 milliseconds. how often the input refreshes
	const barHeight = 50;
	const barWidth = 14;
	
	var c=document.getElementById("can");
	var ctx=c.getContext("2d");
	
	var rotAngle;
	var throttle;
	var clutch;
	var brake;

	function refreshInputs(){
		$.getJSON('http://localhost:8000/restcars/api', function(data)
		{
			ctx.clearRect(0, 0, can.width, can.height);
			
			rotAngle = data.input.mUnfilteredSteering*360;
			throttle = (1-data.input.mUnfilteredThrottle)*barHeight;
			clutch = (1-data.input.mUnfilteredClutch)*barHeight;
			brake = (1-data.input.mUnfilteredBrake)*barHeight;
			
			// background
			ctx.globalAlpha=0.5;
			ctx.fillStyle = "black";
			ctx.fillRect(0,0,barWidth*3+16+barHeight+20,barHeight+20);
			
			ctx.translate(10,10);
			  
			// Frame for Pedal Inputs
			ctx.globalAlpha=1;
			ctx.lineWidth = 1;
			ctx.strokeStyle = "black";
			for (var i=0; i<3; i++)
			  ctx.strokeRect(barWidth*i+4*i,0,barWidth,barHeight);

			// Pedal Inputs
			//ctx.globalAlpha=0.1;
			ctx.fillStyle = "#43AEFF";
			ctx.fillRect(0,clutch,barWidth,barHeight-clutch);
			ctx.fillStyle = "#FF5B00";
			ctx.fillRect(barWidth*1+4*1,brake,barWidth,barHeight-brake);
			ctx.fillStyle = "#8BC34A";
			ctx.fillRect(barWidth*2+4*2,throttle,barWidth,barHeight-throttle);
			  
			// Steering Rim
			ctx.strokeStyle = "white";
			ctx.lineWidth = 3;
			ctx.beginPath();
			ctx.arc(barWidth*3+16+barHeight/2,barHeight/2+1,barHeight/2-1,0,2*Math.PI);
			ctx.stroke();

			// Translate and Rotate to have center of steering wheel
			ctx.translate(barWidth*3+16+barHeight/2,barHeight/2+1);
			ctx.rotate(rotAngle*Math.PI/180);
			
			// Steering Line horizontal
			ctx.lineWidth = 3;
			ctx.beginPath();
			ctx.moveTo(-barHeight/2,0);
			ctx.lineTo(barHeight/2,0);
			ctx.stroke();

			// Steering line vertical
			ctx.beginPath();
			ctx.moveTo(0,0);
			ctx.lineTo(0,barHeight/2);
			ctx.stroke();
			
			// Translate and Rotate back for next loop
			ctx.rotate(-rotAngle*Math.PI/180);
			ctx.translate(-(barWidth*3+16+barHeight/2),-(barHeight/2+1));
			ctx.translate(-10,-10);

		});
	}
 	
	setInterval(refreshInputs, refreshInterval);
	
    </script>
</body>
</html>