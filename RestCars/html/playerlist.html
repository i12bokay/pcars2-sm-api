<html>
<head>
    <link rel="stylesheet" type="text/css" href="./css/players.css">
    <link rel="stylesheet" type="text/css" href="./css/carclass.css">
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta charset="UTF-8"/>
</head>

<table id="players" border="0" cellspacing="0" cellpadding="0">
    <colgroup>
        <col width="10%">
        <col width="15%">
        <col width="35%">
        <col width="8%">
        <col width="32%">
        <col width="5%">
    </colgroup>
</table>
<script language="javascript" type="text/javascript" src="jquery-2.2.0.min.js"></script>
<script language="javascript" type="text/javascript">
    const refreshInterval = 1000;
    function SortParticipiants(a,b){
        var aPosition = a.mRacePosition;
        var bPosition = b.mRacePosition;
        return ((aPosition < bPosition) ? -1 : ((aPosition > bPosition) ? 1 : 0));
    }

    function refreshTable(){
        $.getJSON('http://localhost:8000/restcars/api', function(data){

            $("#players tr").remove();                                     
                              
            if(!data) return;

            if(data.participiants.mNumParticipiants < 1) return;
            var participiants = data.participiants.mParticipiantInfo;

            participiants.sort(SortParticipiants); // Sorting  mapped to raceposition

            for(var i=0; i<participiants.length; i++){
                var row = $("<tr />")
                
                $("#players").append(row);

                var raceposition = $("<td class='pos' />");
                raceposition.append(participiants[i].mRacePosition);
                
                //append raceposition
                row.append(raceposition);

                // append car class
                var cclass = participiants[i].mCarClass;
                row.append($("<td class='cclass " + cclass + "'/>").append(participiants[i].mCarClass));
                
                // append player name
                row.append($("<td class='name' />").append(participiants[i].mName));
                
                // append current lap
                row.append($("<td class='cLap' />").append(participiants[i].mCurrentLap));
                
                // append best laptime
                row.append($("<td class='time' />").append(participiants[i].mFastesLapTime));
                
                // append coordinates
                
                var x = Math.trunc(participiants[i].position.x);
                var y = Math.trunc(participiants[i].position.y);
                var z = Math.trunc(participiants[i].position.z);


                row.append($("<td class='x' />").append("x:"+ x + "y" + y, "z" +z));

            }

        });
    }
    setInterval(refreshTable, refreshInterval);

</script>

</html>